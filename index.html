<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MetaRouter Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      gap: 20px;
      padding: 20px;
    }
    .container {
      flex: 1;
    }
    .payload {
      flex: 1;
      background: #f4f4f4;
      padding: 20px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    select, button {
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>MetaRouter Test Page</h1>

    <label for="eventSelect">Choose an event:</label>
    <select id="eventSelect" onchange="updatePayloadPreview()">
      <option value="User Signup">User Signup</option>
      <option value="Product Viewed">Product Viewed</option>
      <option value="Checkout Started">Checkout Started</option>
      <option value="Order Completed">Order Completed</option>
    </select>

    <button onclick="sendEvent()">Send Event</button>
  </div>

  <div class="payload" id="payloadDisplay">
    Event payload will appear here...
  </div>

  <!-- MetaRouter Snippet -->
  <script type="text/javascript">
    !(function() {
      var analytics = (window.analytics = window.analytics || []);
      if (!analytics.initialize) {
        if (analytics.invoked) {
          console.error("MetaRouter snippet included twice.");
        } else {
          analytics.invoked = true;
          analytics.methods = [
            "trackSubmit", "trackClick", "trackLink", "trackForm",
            "pageview", "identify", "reset", "group", "track", "ready",
            "alias", "page", "once", "off", "on"
          ];
          analytics.factory = function(method) {
            return function() {
              var args = Array.prototype.slice.call(arguments);
              args.unshift(method);
              analytics.push(args);
              return analytics;
            };
          };
          for (var i = 0; i < analytics.methods.length; i++) {
            var method = analytics.methods[i];
            analytics[method] = analytics.factory(method);
          }
          analytics.load = function(key) {
            var script = document.createElement("script");
            script.type = "text/javascript";
            script.async = true;
            script.src = "https://ajs.metarouter.io/" + key + ".js";
            var first = document.getElementsByTagName("script")[0];
            first.parentNode.insertBefore(script, first);
          };
          analytics.SNIPPET_VERSION = "4.13.1";
          analytics.load("demo_anthony");
          analytics.page();
        }
      }
    })();

    const eventProperties = {
      "User Signup": {
        category: "User",
        label: "Signup Button",
        plan: "Free"
      },
      "Product Viewed": {
        category: "Ecommerce",
        label: "Product Page",
        product_id: "SKU-12345"
      },
      "Checkout Started": {
        category: "Ecommerce",
        label: "Cart Page",
        cart_value: 99.99
      },
      "Order Completed": {
        category: "Ecommerce",
        label: "Confirmation Page",
        order_id: "ORD-98765",
        revenue: 149.99
      }
    };

    function updatePayloadPreview() {
      const eventName = document.getElementById('eventSelect').value;
      const properties = eventProperties[eventName];

      const payload = {
        type: 'track',
        event: eventName,
        properties: properties
      };

      document.getElementById('payloadDisplay').textContent = JSON.stringify(payload, null, 2);
    }

    function sendEvent() {
      const eventName = document.getElementById('eventSelect').value;
      const properties = eventProperties[eventName];
      analytics.track(eventName, properties);
    }

    // Initialize payload preview on load
    window.onload = updatePayloadPreview;
  </script>
</body>
</html>
